<template>
    <lightning-card title="Certificate Importer" icon-name="custom:custom19">
        <div class="slds-p-around_medium">
            <div class="slds-text-longform slds-m-bottom_medium">
                <h3 class="slds-text-heading_small slds-m-bottom_small">CSV Format Requirements</h3>
                <p class="slds-m-bottom_small">Please prepare your CSV file with the following columns:</p>
                <ul class="slds-m-bottom_small">
                    <li><strong>sf contact id</strong> - Optional, Salesforce Contact ID (either this or ETO Contact ID is required)</li>
                    <li><strong>eto contact id</strong> - Optional, ETO Contact ID (either this or SF Contact ID is required)</li>
                    <li><strong>date earned</strong> - Required, format: YYYY-MM-DD</li>
                    <li><strong>certificate type</strong> - Required, the type of certificate</li>
                    <li><strong>certificate id</strong> - Required, unique identifier for the certificate</li>
                    <li><strong>expiration date</strong> - Optional, format: YYYY-MM-DD</li>
                </ul>
                <p class="slds-text-color_weak">Note: At least one of SF Contact ID or ETO Contact ID must be provided. Certificate names will be automatically generated by the system.</p>
            </div>

            <lightning-file-upload
                label="Upload CSV File"
                accept={acceptedFormats}
                record-id={recordId}
                onuploadfinished={handleUploadFinished}
                multiple="false"
            ></lightning-file-upload>

            <template if:true={showPreview}>
                <div class="slds-m-top_medium">
                    <h3 class="slds-text-heading_small">Preview</h3>
                    <lightning-datatable
                        key-field="id"
                        data={previewData}
                        columns={columns}
                        hide-checkbox-column="true"
                    ></lightning-datatable>
                </div>

                <div class="slds-m-top_medium">
                    <lightning-button
                        label="Process Import"
                        variant="brand"
                        onclick={handleProcessImport}
                        disabled={isProcessing}
                    ></lightning-button>
                </div>
            </template>

            <template if:true={showResults}>
                <div class="slds-m-top_medium">
                    <h3 class="slds-text-heading_small">Results</h3>
                    <lightning-datatable
                        key-field="id"
                        data={resultsData}
                        columns={resultsColumns}
                        hide-checkbox-column="true"
                    ></lightning-datatable>
                </div>

                <div class="slds-m-top_medium">
                    <lightning-button
                        label="Download Results"
                        variant="brand"
                        onclick={handleDownloadResults}
                    ></lightning-button>
                </div>
            </template>
        </div>
    </lightning-card>
</template>